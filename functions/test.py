import base64
from py.functions.get_txt_from_docai_json import Json_Transformer
import logging
import json

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger("cloudLogger")

data = {'attributes': {'specversion': '1.0', 'id': '10357251136181206', 'source': '//pubsub.googleapis.com/projects/lawli-bab83/topics/documentai_pdf_new_doc', 'type': 'google.cloud.pubsub.topic.v1.messagePublished', 'datacontenttype': 'application/json', 'time': '2024-03-04T09:02:14.729Z'}, 'data': {'message': {'attributes': {'bucketId': 'lawli-bab83.appspot.com', 'eventTime': '2024-03-04T09:02:14.684767Z', 'eventType': 'OBJECT_FINALIZE', 'notificationConfig': 'projects/_/buckets/lawli-bab83.appspot.com/notificationConfigs/13', 'objectGeneration': '1709542934681655', 'objectId': 'accounts/lawli/pratiche/1/documenti/MODELO FACTURA CON IGIC - FACTURA 1.pdf_docai/312557971798266246/0/originale_MODELO FACTURA CON IGIC - FACTURA 1-0.json', 'payloadFormat': 'JSON_API_V1'}, 'data': 'ewogICJraW5kIjogInN0b3JhZ2Ujb2JqZWN0IiwKICAiaWQiOiAibGF3bGktYmFiODMuYXBwc3BvdC5jb20vYWNjb3VudHMvbGF3bGkvcHJhdGljaGUvMS9kb2N1bWVudGkvTU9ERUxPIEZBQ1RVUkEgQ09OIElHSUMgLSBGQUNUVVJBIDEucGRmX2RvY2FpLzMxMjU1Nzk3MTc5ODI2NjI0Ni8wL29yaWdpbmFsZV9NT0RFTE8gRkFDVFVSQSBDT04gSUdJQyAtIEZBQ1RVUkEgMS0wLmpzb24vMTcwOTU0MjkzNDY4MTY1NSIsCiAgInNlbGZMaW5rIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3N0b3JhZ2UvdjEvYi9sYXdsaS1iYWI4My5hcHBzcG90LmNvbS9vL2FjY291bnRzJTJGbGF3bGklMkZwcmF0aWNoZSUyRjElMkZkb2N1bWVudGklMkZNT0RFTE8lMjBGQUNUVVJBJTIwQ09OJTIwSUdJQyUyMC0lMjBGQUNUVVJBJTIwMS5wZGZfZG9jYWklMkYzMTI1NTc5NzE3OTgyNjYyNDYlMkYwJTJGb3JpZ2luYWxlX01PREVMTyUyMEZBQ1RVUkElMjBDT04lMjBJR0lDJTIwLSUyMEZBQ1RVUkElMjAxLTAuanNvbiIsCiAgIm5hbWUiOiAiYWNjb3VudHMvbGF3bGkvcHJhdGljaGUvMS9kb2N1bWVudGkvTU9ERUxPIEZBQ1RVUkEgQ09OIElHSUMgLSBGQUNUVVJBIDEucGRmX2RvY2FpLzMxMjU1Nzk3MTc5ODI2NjI0Ni8wL29yaWdpbmFsZV9NT0RFTE8gRkFDVFVSQSBDT04gSUdJQyAtIEZBQ1RVUkEgMS0wLmpzb24iLAogICJidWNrZXQiOiAibGF3bGktYmFiODMuYXBwc3BvdC5jb20iLAogICJnZW5lcmF0aW9uIjogIjE3MDk1NDI5MzQ2ODE2NTUiLAogICJtZXRhZ2VuZXJhdGlvbiI6ICIxIiwKICAiY29udGVudFR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgInRpbWVDcmVhdGVkIjogIjIwMjQtMDMtMDRUMDk6MDI6MTQuNjg0WiIsCiAgInVwZGF0ZWQiOiAiMjAyNC0wMy0wNFQwOTowMjoxNC42ODRaIiwKICAic3RvcmFnZUNsYXNzIjogIlNUQU5EQVJEIiwKICAidGltZVN0b3JhZ2VDbGFzc1VwZGF0ZWQiOiAiMjAyNC0wMy0wNFQwOTowMjoxNC42ODRaIiwKICAic2l6ZSI6ICIxODM1NzYiLAogICJtZDVIYXNoIjogIldwQmxTblBhZGFPUFpaRStmZlY0MVE9PSIsCiAgIm1lZGlhTGluayI6ICJodHRwczovL3N0b3JhZ2UuZ29vZ2xlYXBpcy5jb20vZG93bmxvYWQvc3RvcmFnZS92MS9iL2xhd2xpLWJhYjgzLmFwcHNwb3QuY29tL28vYWNjb3VudHMlMkZsYXdsaSUyRnByYXRpY2hlJTJGMSUyRmRvY3VtZW50aSUyRk1PREVMTyUyMEZBQ1RVUkElMjBDT04lMjBJR0lDJTIwLSUyMEZBQ1RVUkElMjAxLnBkZl9kb2NhaSUyRjMxMjU1Nzk3MTc5ODI2NjI0NiUyRjAlMkZvcmlnaW5hbGVfTU9ERUxPJTIwRkFDVFVSQSUyMENPTiUyMElHSUMlMjAtJTIwRkFDVFVSQSUyMDEtMC5qc29uP2dlbmVyYXRpb249MTcwOTU0MjkzNDY4MTY1NSZhbHQ9bWVkaWEiLAogICJjcmMzMmMiOiAiOElXbG9RPT0iLAogICJldGFnIjogIkNMZXc1dHFmMm9RREVBRT0iCn0K', 'messageId': '10357251136181206', 'message_id': '10357251136181206', 'publishTime': '2024-03-04T09:02:14.729Z', 'publish_time': '2024-03-04T09:02:14.729Z'}, 'subscription': 'projects/lawli-bab83/subscriptions/eventarc-europe-west3-get-txt-from-docai-json-628037-sub-632'}}

decoded = base64.b64decode(data['data']['message']['data']).decode()
object_id = data["data"]["message"]["attributes"]["objectId"]

result = Json_Transformer(logger, decoded, object_id).process_json()

print(result)